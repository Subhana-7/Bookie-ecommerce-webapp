<style>
  .chat-window {
    border: 1px solid #ddd;
    border-radius: 5px;
    padding: 10px;
    max-width: 400px;
    margin: auto;
    background: #f9f9f9;
}
.chat-history {
    max-height: 300px;
    overflow-y: auto;
    margin-bottom: 10px;
}
.chat-form {
    display: flex;
    gap: 5px;
}

</style>

<div id="chatbox" class="container">
  <div class="chat-window">
      <div id="chat-history" class="chat-history"></div>
      <form id="chat-form" class="chat-form">
          <input type="text" id="user-input" class="form-control" placeholder="Type your message..." required>
          <button type="submit" class="btn btn-primary">Send</button>
      </form>
  </div>
</div>


<script>
document.getElementById('chat-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const userInput = document.getElementById('user-input').value;

    addMessage('You', userInput);
    document.getElementById('user-input').value = '';

    const loadingMessage = addMessage('AI', '', true);

    try {
        const response = await fetch('/chat', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ message: userInput })
        });
        const data = await response.json();

        loadingMessage.textContent = `AI: ${data.reply}`;
    } catch (error) {
        loadingMessage.textContent = 'AI: Oops! Something went wrong.';
    }
});

function addMessage(sender, text, isLoading = false) {
    const chatHistory = document.getElementById('chat-history');
    const messageDiv = document.createElement('div');
    messageDiv.className = `message ${sender.toLowerCase()}`;
    messageDiv.textContent = isLoading ? `${sender} is typing...` : `${sender}: ${text}`;
    chatHistory.appendChild(messageDiv);
    chatHistory.scrollTop = chatHistory.scrollHeight;
    return messageDiv;
}


</script>
